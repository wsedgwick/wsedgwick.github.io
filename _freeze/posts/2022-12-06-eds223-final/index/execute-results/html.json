{
  "hash": "8b7bfc86c3381914d998378eb130a450",
  "result": {
    "markdown": "---\ntitle: \"Geospatial Analysis Final Blog Post\"\ndescription: \"EDS 223 (Geospatial Analysis and Remote Sensing) Assignment 3 Blog Post\"\nauthor:\n  - name: Wade Sedgwick\n    url: https://wsedgwick.github.io/\n    affiliation: Master of Environmental Data Science Program, Bren School\n    affiliation-url: https://ucsb-meds.github.io/ \ndate: 12-06-2022\ncategories: [Quarto, R, MEDS, Geospatial] # self-defined categories\ncitation: \n  url: https://wsedgwick.github.io/posts/2022-10-24-quarto-blogs/ \ndraft: false # setting this to `true` will prevent your post from appearing on your listing page until you're ready!\n---\n\n\n### In this blog post, I will be analyzing the major power crisis that occurred in Texas on February, 2021 when significant winter storms hit the US.\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Reading in Houston tiles\n\nv5_before <- read_stars(\"data/VNP46A1/VNP46A1.A2021038.h08v05.001.2021039064328.tif\")\nv6_before <- read_stars(\"data/VNP46A1/VNP46A1.A2021038.h08v06.001.2021039064329.tif\")\nv5_after <- read_stars(\"data/VNP46A1/VNP46A1.A2021047.h08v05.001.2021048091106.tif\")\nv6_after <- read_stars(\"data/VNP46A1/VNP46A1.A2021047.h08v06.001.2021048091105.tif\")\n\n# Joining Houston tiles\njoined_before <- st_mosaic(v5_before, v6_before)\njoined_after <- st_mosaic(v5_after, v6_after)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Difference in light between the two days\njoined <- joined_after - joined_before\n\n# Only locations with a drop of more than 200 nW cm-2sr-1\nblackout <- joined > 200\n\n# Assigning all values below 200 to NA\njoined[joined < 200] <- NA\n\n# Making joined map of houston blackout into an sf object\nvectorized <- st_as_sf(joined)\n\n# If any invalid geometries, makes them valid\nvec_map <- st_make_valid(vectorized)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# 5 points to close the geometry\ncoords <- list(rbind(c(-96.5, 29), c(-96.5, 30.5), c(-94.5, 30.5), c(-94.5, 29), c(-96.5, 29)))\n\n# Making points into a polygon\nbox <- st_polygon(coords)\n\n# Making into sf collection\nbox <- st_sfc(box, crs = \"EPSG:4326\")\nclass(box)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"sfc_POLYGON\" \"sfc\"        \n```\n:::\n\n```{.r .cell-code}\n# Cropping houston blackout map to 'box' coordinates\nroi <- st_crop(vec_map, box)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: attribute variables are assumed to be spatially constant throughout all\ngeometries\n```\n:::\n\n```{.r .cell-code}\nbox\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nGeometry set for 1 feature \nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: -96.5 ymin: 29 xmax: -94.5 ymax: 30.5\nGeodetic CRS:  WGS 84\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nPOLYGON ((-96.5 29, -96.5 30.5, -94.5 30.5, -94...\n```\n:::\n\n```{.r .cell-code}\n# Transforming crs back to NAD83\nhoust_roi <- st_transform(roi,  crs = \"EPSG:3083\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Define query\nquery <- \"SELECT * FROM gis_osm_roads_free_1 WHERE fclass='motorway'\"\n\n# Read in freeways with query\nhighways <- st_read(\"data/gis_osm_roads_free_1.gpkg\", query = query)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading query `SELECT * FROM gis_osm_roads_free_1 WHERE fclass='motorway'' from data source `/Users/wsedgwick/Desktop/bren_meds/BREN MEDS/wsedgwick.github.io/posts/2022-12-06-eds223-final/data/gis_osm_roads_free_1.gpkg' \n  using driver `GPKG'\nSimple feature collection with 6085 features and 10 fields\nGeometry type: LINESTRING\nDimension:     XY\nBounding box:  xmin: -96.50429 ymin: 29.00174 xmax: -94.39619 ymax: 30.50886\nGeodetic CRS:  WGS 84\n```\n:::\n\n```{.r .cell-code}\n# Changing crs to NAD83, buffer of 200 meters, union gets rid of boundaries\nhighways <- highways %>% \n  st_transform(\"EPSG:3083\") %>% \n  st_buffer(200) %>% \n  st_union()\n\n\n\n# Filter blackout areas in Houston to areas farther than 200 meters from highways\nbo_far_from_road <- houst_roi[highways, op = st_disjoint]\n\n# Define query\nquery1 <- \"SELECT * FROM gis_osm_buildings_a_free_1 WHERE (type IS NULL AND name IS NULL)\"\n\n# Load in buildings dataset with SQL query\nbuildings <- st_read(\"data/gis_osm_buildings_a_free_1.gpkg\", query = query1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading query `SELECT * FROM gis_osm_buildings_a_free_1 WHERE (type IS NULL AND name IS NULL)' from data source `/Users/wsedgwick/Desktop/bren_meds/BREN MEDS/wsedgwick.github.io/posts/2022-12-06-eds223-final/data/gis_osm_buildings_a_free_1.gpkg' \n  using driver `GPKG'\nSimple feature collection with 413297 features and 5 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -96.50055 ymin: 29.00344 xmax: -94.53285 ymax: 30.50393\nGeodetic CRS:  WGS 84\n```\n:::\n\n```{.r .cell-code}\n# Change crs to NAD83\nbuildings <- st_transform(buildings, crs = \"EPSG:3083\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# filtering houston blackout areas by buildings\nbo_homes <- houst_roi[buildings, ]\n\n# Variable with number of buildings with blackouts\nimpacted_homes_count <- nrow(bo_homes)\n\n# Printing impacted homes\npaste0(\"There are \", impacted_homes_count, \" impacted homes in the city of Houston.\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"There are 3523 impacted homes in the city of Houston.\"\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Loading geometries\ngeoms <- st_read(\"data/ACS_2019_5YR_TRACT_48_TEXAS.gdb\", layer = \"ACS_2019_5YR_TRACT_48_TEXAS\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `ACS_2019_5YR_TRACT_48_TEXAS' from data source \n  `/Users/wsedgwick/Desktop/bren_meds/BREN MEDS/wsedgwick.github.io/posts/2022-12-06-eds223-final/data/ACS_2019_5YR_TRACT_48_TEXAS.gdb' \n  using driver `OpenFileGDB'\nSimple feature collection with 5265 features and 15 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -106.6456 ymin: 25.83716 xmax: -93.50804 ymax: 36.5007\nGeodetic CRS:  NAD83\n```\n:::\n\n```{.r .cell-code}\n# Loading income data\nincome <- st_read(\"data/ACS_2019_5YR_TRACT_48_TEXAS.gdb\", layer = \"X19_INCOME\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nReading layer `X19_INCOME' from data source \n  `/Users/wsedgwick/Desktop/bren_meds/BREN MEDS/wsedgwick.github.io/posts/2022-12-06-eds223-final/data/ACS_2019_5YR_TRACT_48_TEXAS.gdb' \n  using driver `OpenFileGDB'\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: no simple feature geometries present: returning a data.frame or tbl_df\n```\n:::\n\n```{.r .cell-code}\n# Selecting median income data and renaming\nincome_median <- income %>% \n  dplyr::select(\"GEOID\", \"B19013e1\") %>% \n  rename(GEOID_Data = \"GEOID\", median_income = \"B19013e1\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncensus_tracts <- st_transform(geoms, crs = \"EPSG:4326\")\nhoust_roi <- st_transform(houst_roi, crs = \"EPSG:4326\")\n\n# Joining census tract and madian income data\nincome_median_sf <- full_join(census_tracts, income_median, by = \"GEOID_Data\")\n\n# Changing crs\nincome_median_sf <- income_median_sf %>% \n  st_transform(crs = \"EPSG:3083\")\n\n# Census tracts that had blackouts\nbuildings_bo_census <- income_median_sf[bo_homes, ]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Changing crses\nbox_nad <- st_transform(box, crs = \"EPSG:3083\")\ngeoms_nad <- st_transform(geoms, crs = \"EPSG:3083\")\n\n# Filtering geometries by box coordinates\ncensus_tracts_all <- geoms_nad[box_nad, ]\n\n# Plotting Median Income in Houston area, with impacted tracts having black borders\ntm_shape(census_tracts_all) +\n  tm_borders(col = \"grey\", alpha = 0.2) +\n  tm_shape(income_median_sf) +\n  tm_fill(col = \"median_income\", title = \"Median Income\\nby Tract\") +\n  tm_layout(legend.outside = TRUE,\n            legend.outside.position = c(\"left\", \"bottom\")) +\n  tm_shape(buildings_bo_census) +\n  tm_borders(col = \"black\", lwd = 0.3)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Average median income for impacted buildings, not included in graph\navg_med_income_bo <- mean(buildings_bo_census$median_income, na.rm = TRUE)\n\n# Histogram of median income distribution for tracts with blackouts\nhist1 <- ggplot(data = buildings_bo_census, aes(x = median_income)) +\n  geom_histogram() +\n  labs(title = \"Histogram of Median Income\\nfor Tracts with Blackouts\",\n       x = \"Median Income\",\n       y = \"Count\")\n\n# Dropping geoms of tracts with blackout buildings to get tracts without blackouts\nbuildings_bo_census_dropped <- st_drop_geometry(buildings_bo_census)\nno_blackout_tracts <- anti_join(income_median_sf, buildings_bo_census_dropped)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nJoining, by = c(\"STATEFP\", \"COUNTYFP\", \"TRACTCE\", \"GEOID\", \"NAME\", \"NAMELSAD\",\n\"MTFCC\", \"FUNCSTAT\", \"ALAND\", \"AWATER\", \"INTPTLAT\", \"INTPTLON\", \"Shape_Length\",\n\"Shape_Area\", \"GEOID_Data\", \"median_income\")\n```\n:::\n\n```{.r .cell-code}\n# Average median income for nonimpacted buildings, not included in graph\navg_med_income_no_bo <- mean(no_blackout_tracts$median_income, na.rm = TRUE)\n\n# Histogram of median income distribution for tracts without blackouts\nhist2 <- ggplot(data = no_blackout_tracts, aes(x = median_income)) +\n  geom_histogram() +\n  labs(title = \"Histogram of Median Income\\nfor Tracts without Blackouts\",\n       x = \"Median Income\",\n       y = \"Count\")\n\n# Combining histograms for comparison\nggarrange(hist1, hist2, nrow = 2)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 9 rows containing non-finite values (stat_bin).\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 54 rows containing non-finite values (stat_bin).\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-2.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}